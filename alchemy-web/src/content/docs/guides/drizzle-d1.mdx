---
title: Drizzle with D1
description: Build a full-stack application with Drizzle ORM and Cloudflare D1 Database using Alchemy for type-safe database operations.
sidebar:
  order: 15
---

import { Tabs, TabItem, Steps } from '@astrojs/starlight/components';

Build a full-stack application with Drizzle ORM and Cloudflare D1 Database. This guide shows you how to set up a type-safe database layer with automated migrations and a web interface.

<Steps>

1. **Create your project**

   Start by creating a new project and installing dependencies.

   ```sh
   mkdir drizzle-d1-app
   cd drizzle-d1-app
   ```

   <Tabs syncKey="pkgManager">
     <TabItem label="bun">
       ```sh
       bun init -y
       bun add alchemy drizzle-orm
       bun add -D drizzle-kit @types/node
       bun add -g wrangler
       ```
     </TabItem>
     <TabItem label="npm">
       ```sh
       npm init -y
       npm install alchemy drizzle-orm
       npm install -D drizzle-kit @types/node
       npm install -g wrangler
       ```
     </TabItem>
     <TabItem label="pnpm">
       ```sh
       pnpm init
       pnpm add alchemy drizzle-orm
       pnpm add -D drizzle-kit @types/node
       pnpm add -g wrangler
       ```
     </TabItem>
     <TabItem label="yarn">
       ```sh
       yarn init -y
       yarn add alchemy drizzle-orm
       yarn add -D drizzle-kit @types/node
       yarn global add wrangler
       ```
     </TabItem>
   </Tabs>

2. **Login to Cloudflare**

   Authenticate with your Cloudflare account.

   <Tabs syncKey="pkgManager">
     <TabItem label="bun">
       ```sh
       bun wrangler login
       ```
     </TabItem>
     <TabItem label="npm">
       ```sh
       npx wrangler login
       ```
     </TabItem>
     <TabItem label="pnpm">
       ```sh
       pnpm wrangler login
       ```
     </TabItem>
     <TabItem label="yarn">
       ```sh
       yarn wrangler login
       ```
     </TabItem>
   </Tabs>

   :::tip
   Make sure you have a [Cloudflare account](https://dash.cloudflare.com/sign-up) (free tier works)
   :::

3. **Set up Drizzle schema**

   Create your database schema with Drizzle ORM:

   ```typescript
   // src/schema.ts
   import { integer, sqliteTable, text } from 'drizzle-orm/sqlite-core';

   export const users = sqliteTable('users', {
     id: integer('id').primaryKey({ autoIncrement: true }),
     name: text('name').notNull(),
     email: text('email').notNull().unique(),
     createdAt: integer('created_at', { mode: 'timestamp' }).notNull(),
   });

   export const posts = sqliteTable('posts', {
     id: integer('id').primaryKey({ autoIncrement: true }),
     title: text('title').notNull(),
     content: text('content').notNull(),
     authorId: integer('author_id').notNull().references(() => users.id),
     createdAt: integer('created_at', { mode: 'timestamp' }).notNull(),
   });
   ```

4. **Configure Drizzle Kit**

   Create `drizzle.config.ts` for migration generation:

   ```typescript
   // drizzle.config.ts
   import { defineConfig } from 'drizzle-kit';

   export default defineConfig({
     schema: './src/schema.ts',
     out: './migrations',
     dialect: 'sqlite',
     driver: 'd1-http',
   });
   ```

5. **Generate migrations**

   Generate SQL migrations from your schema:

   <Tabs syncKey="pkgManager">
     <TabItem label="bun">
       ```sh
       bun drizzle-kit generate
       ```
     </TabItem>
     <TabItem label="npm">
       ```sh
       npx drizzle-kit generate
       ```
     </TabItem>
     <TabItem label="pnpm">
       ```sh
       pnpm drizzle-kit generate
       ```
     </TabItem>
     <TabItem label="yarn">
       ```sh
       yarn drizzle-kit generate
       ```
     </TabItem>
   </Tabs>

   This creates migration files in the `migrations/` directory.

6. **Create your infrastructure**

   Create `alchemy.run.ts` with D1 database and Worker:

   ```typescript
   // alchemy.run.ts
   import alchemy from "alchemy";
   import { D1Database, Worker } from "alchemy/cloudflare";

   const app = await alchemy("drizzle-d1-app");

   // Create D1 database with migrations
   const database = await D1Database("app-db", {
     name: "app-db",
     migrationsDir: "./migrations",
     migrationsTable: "drizzle_migrations", // Compatible with Drizzle
   });

   // Create API worker
   const worker = await Worker("api-worker", {
     name: "api-worker",
     entrypoint: "./src/worker.ts",
     bindings: {
       DB: database,
     },
   });

   console.log(`API available at: ${worker.url}`);
   await app.finalize();
   ```

7. **Create your worker with Drizzle**

   Create `src/worker.ts` with Drizzle ORM integration:

   ```typescript
   // src/worker.ts
   import { drizzle } from 'drizzle-orm/d1';
   import { users, posts } from './schema';

   export interface Env {
     DB: D1Database;
   }

   export default {
     async fetch(request: Request, env: Env): Promise<Response> {
       const db = drizzle(env.DB);
       const url = new URL(request.url);

       // Handle CORS
       const headers = {
         'Access-Control-Allow-Origin': '*',
         'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
         'Access-Control-Allow-Headers': 'Content-Type',
         'Content-Type': 'application/json',
       };

       if (request.method === 'OPTIONS') {
         return new Response(null, { headers });
       }

       try {
         if (url.pathname === '/api/users' && request.method === 'GET') {
           const allUsers = await db.select().from(users);
           return new Response(JSON.stringify(allUsers), { headers });
         }

         if (url.pathname === '/api/users' && request.method === 'POST') {
           const { name, email } = await request.json();
           const newUser = await db.insert(users).values({
             name,
             email,
             createdAt: new Date(),
           }).returning();
           
           return new Response(JSON.stringify(newUser[0]), { headers });
         }

         if (url.pathname === '/api/posts' && request.method === 'GET') {
           const allPosts = await db.select().from(posts);
           return new Response(JSON.stringify(allPosts), { headers });
         }

         if (url.pathname === '/api/posts' && request.method === 'POST') {
           const { title, content, authorId } = await request.json();
           const newPost = await db.insert(posts).values({
             title,
             content,
             authorId,
             createdAt: new Date(),
           }).returning();
           
           return new Response(JSON.stringify(newPost[0]), { headers });
         }

         return new Response('Not found', { status: 404, headers });
       } catch (error) {
         return new Response(JSON.stringify({ error: error.message }), { 
           status: 500, 
           headers 
         });
       }
     },
   };
   ```

8. **Deploy your application**

   Deploy your D1 database and worker:

   <Tabs syncKey="pkgManager">
     <TabItem label="bun">
       ```sh
       bun alchemy deploy
       ```
     </TabItem>
     <TabItem label="npm">
       ```sh
       npx alchemy deploy
       ```
     </TabItem>
     <TabItem label="pnpm">
       ```sh
       pnpm alchemy deploy
       ```
     </TabItem>
     <TabItem label="yarn">
       ```sh
       yarn alchemy deploy
       ```
     </TabItem>
   </Tabs>

   Your API will be available at the displayed URL. Test it with:

   ```sh
   # Create a user
   curl -X POST https://api-worker.your-account.workers.dev/api/users \
     -H "Content-Type: application/json" \
     -d '{"name": "John Doe", "email": "john@example.com"}'

   # Get all users
   curl https://api-worker.your-account.workers.dev/api/users
   ```

9. **Add a web interface**

   Create a simple HTML interface to interact with your API:

   ```html
   <!-- src/index.html -->
   <!DOCTYPE html>
   <html lang="en">
   <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Drizzle D1 App</title>
     <style>
       body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
       .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
       input, textarea { width: 100%; padding: 8px; margin: 5px 0; }
       button { padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
       button:hover { background: #0056b3; }
       .user, .post { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
     </style>
   </head>
   <body>
     <h1>Drizzle D1 App</h1>
     
     <div class="section">
       <h2>Add User</h2>
       <input type="text" id="userName" placeholder="Name" />
       <input type="email" id="userEmail" placeholder="Email" />
       <button onclick="addUser()">Add User</button>
     </div>

     <div class="section">
       <h2>Users</h2>
       <button onclick="loadUsers()">Load Users</button>
       <div id="users"></div>
     </div>

     <div class="section">
       <h2>Add Post</h2>
       <input type="text" id="postTitle" placeholder="Title" />
       <textarea id="postContent" placeholder="Content"></textarea>
       <input type="number" id="postAuthorId" placeholder="Author ID" />
       <button onclick="addPost()">Add Post</button>
     </div>

     <div class="section">
       <h2>Posts</h2>
       <button onclick="loadPosts()">Load Posts</button>
       <div id="posts"></div>
     </div>

     <script>
       const API_BASE = 'https://api-worker.your-account.workers.dev';

       async function addUser() {
         const name = document.getElementById('userName').value;
         const email = document.getElementById('userEmail').value;
         
         const response = await fetch(`${API_BASE}/api/users`, {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify({ name, email })
         });
         
         if (response.ok) {
           document.getElementById('userName').value = '';
           document.getElementById('userEmail').value = '';
           loadUsers();
         }
       }

       async function loadUsers() {
         const response = await fetch(`${API_BASE}/api/users`);
         const users = await response.json();
         
         document.getElementById('users').innerHTML = users.map(user => 
           `<div class="user">
             <strong>${user.name}</strong> (${user.email})
             <br><small>ID: ${user.id}, Created: ${new Date(user.createdAt).toLocaleString()}</small>
           </div>`
         ).join('');
       }

       async function addPost() {
         const title = document.getElementById('postTitle').value;
         const content = document.getElementById('postContent').value;
         const authorId = parseInt(document.getElementById('postAuthorId').value);
         
         const response = await fetch(`${API_BASE}/api/posts`, {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify({ title, content, authorId })
         });
         
         if (response.ok) {
           document.getElementById('postTitle').value = '';
           document.getElementById('postContent').value = '';
           document.getElementById('postAuthorId').value = '';
           loadPosts();
         }
       }

       async function loadPosts() {
         const response = await fetch(`${API_BASE}/api/posts`);
         const posts = await response.json();
         
         document.getElementById('posts').innerHTML = posts.map(post => 
           `<div class="post">
             <strong>${post.title}</strong>
             <p>${post.content}</p>
             <small>Author ID: ${post.authorId}, Created: ${new Date(post.createdAt).toLocaleString()}</small>
           </div>`
         ).join('');
       }
     </script>
   </body>
   </html>
   ```

   :::tip
   Replace `your-account` with your actual Cloudflare account ID in the HTML file.
   :::

10. **(Optional) Tear down**

    Clean up all resources when you're done:

    <Tabs syncKey="pkgManager">
      <TabItem label="bun">
        ```sh
        bun alchemy destroy
        ```
      </TabItem>
      <TabItem label="npm">
        ```sh
        npx alchemy destroy
        ```
      </TabItem>
      <TabItem label="pnpm">
        ```sh
        pnpm alchemy destroy
        ```
      </TabItem>
      <TabItem label="yarn">
        ```sh
        yarn alchemy destroy
        ```
      </TabItem>
    </Tabs>

</Steps>

## Next Steps

You now have a fully functional Drizzle ORM application with Cloudflare D1! Here are some ways to extend it:

- **Add authentication**: Implement user authentication with Cloudflare Access
- **Add more complex queries**: Use Drizzle's query builder for joins and complex operations
- **Add validation**: Use Zod or similar for request validation
- **Add pagination**: Implement pagination for large datasets
- **Add real-time updates**: Use Cloudflare Durable Objects for real-time features

## Learn More

- [Drizzle ORM Documentation](https://orm.drizzle.team/) - Complete ORM documentation
- [Cloudflare D1 Database](/providers/cloudflare/d1-database) - Alchemy D1 resource reference
- [Cloudflare Workers](/guides/cloudflare-worker) - Advanced worker patterns
- [Cloudflare D1 Documentation](https://developers.cloudflare.com/d1/) - Official D1 documentation